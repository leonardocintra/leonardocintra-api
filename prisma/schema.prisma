generator client {
  provider = "prisma-client"
  output   = "../prisma/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Product {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  description String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  plans       Plan[]
}

model Plan {
  id            Int            @id @default(autoincrement())
  name          String         @db.VarChar(100)
  description   String?
  price         Decimal        @db.Decimal
  productId     Int
  active        Boolean        @default(true)
  createdAt     DateTime       @default(now())
  config        Json
  product       Product        @relation(fields: [productId], references: [id])
  subscriptions Subscription[]
}

model Subscription {
  id              Int           @id @default(autoincrement())
  leadId          Int
  planId          Int
  paymentMethod   PaymentMethod @default(PIX)
  nextBillingDate DateTime?
  createdAt       DateTime      @default(now())
  lead            Leads         @relation(fields: [leadId], references: [id])
  plan            Plan          @relation(fields: [planId], references: [id])
}

model WhatsappGroups {
  id              Int     @id @default(autoincrement())
  groupId         String  @db.VarChar(100)
  name            String  @db.VarChar(100)
  transcribeAudio Boolean @default(true)
}

model WhatsAppAudioToText {
  id            Int      @id @default(autoincrement())
  name          String   @db.VarChar(100)
  phone         String   @db.VarChar(20)
  ownerPhone    String?  @db.VarChar(20)
  sendBy        String   @db.VarChar(20)
  message       String
  messageType   String   @default("text") @db.VarChar(10)
  audioDuration Int      @default(0)
  audioMimetype String   @default("text") @db.VarChar(40)
  isGroup       Boolean  @default(false)
  createdAt     DateTime @default(now())
}

model Leads {
  id                              Int                               @id @default(autoincrement())
  name                            String                            @db.VarChar(100)
  phone                           String                            @unique @db.VarChar(20)
  email                           String?                           @db.VarChar(100)
  active                          Boolean                           @default(true)
  createdAt                       DateTime                          @default(now())
  Subscription                    Subscription[]
  WhatsAppAudioToTextAccount      WhatsAppAudioToTextAccount[]
  WhatsAppAudioToTextAccountUsage WhatsAppAudioToTextAccountUsage[]
  salaoReservas                   SalaoReservas[]
}

model WhatsAppAudioToTextAccount {
  id                   Int       @id @default(autoincrement())
  leadId               Int
  instanceName         String    @unique @db.VarChar(60)
  instanceId           String    @unique @db.VarChar(50)
  hash                 String    @unique @db.VarChar(50)
  active               Boolean   @default(false)
  integration          String    @default("WHATSAPP-BAILEYS") @db.VarChar(50)
  createdAt            DateTime  @default(now())
  notifiedSuccessfully Boolean   @default(true)
  retry                Int       @default(0)
  pairingCode          String?   @db.VarChar(20)
  pairingCodeExpiresAt DateTime?
  instructionsSent     Boolean   @default(false)
  pairingCodeManual    Boolean   @default(false)
  lead                 Leads     @relation(fields: [leadId], references: [id])
}

model WhatsAppAudioToTextAccountUsage {
  id               Int      @id @default(autoincrement())
  leadId           Int
  duration         Int
  messageId        String   @db.VarChar(100)
  messageTimestamp Int
  createdAt        DateTime @default(now())
  lead             Leads    @relation(fields: [leadId], references: [id])
}

enum PaymentMethod {
  PIX
  MERCADO_PAGO_ASSINATURA
}

enum SalaoStatusReservaEnum {
  proposta
  reservada
  confirmada
  cancelada
  pendente_sinal
}

model SalaoReservas {
  id                Int                    @id @default(autoincrement())
  leadId            Int
  lead              Leads                  @relation(fields: [leadId], references: [id], onDelete: Restrict)
  dataEvento        DateTime               @db.Date
  horarioInicio     String?                @db.VarChar(10)
  horarioFim        String?                @db.VarChar(10)
  tipoLocacao       String?                @db.VarChar(50)
  convidadosEst     Int?
  sinalPago         Boolean                @default(false)
  valorTotal        Decimal?               @db.Decimal
  valorSinal        Decimal?               @db.Decimal
  status            SalaoStatusReservaEnum @default(proposta)
  criadoEm          DateTime               @default(now())
  notas             String?                @db.Text
  temaId            Int?
  tema              SalaoTemas?            @relation(fields: [temaId], references: [id], onDelete: SetNull)
  salaoReservasLogs SalaoReservasLog[]
}

model SalaoReservasLog {
  id        Int           @id @default(autoincrement())
  reservaId Int
  reserva   SalaoReservas @relation(fields: [reservaId], references: [id], onDelete: Cascade)
  evento    String        @db.Text
  payload   Json
  criadoEm  DateTime      @default(now())
}

model SalaoTemas {
  id               Int                @id @default(autoincrement())
  nome             String             @db.VarChar(100)
  descricao        String?            @db.Text
  salaoTemaImagens SalaoTemaImagens[]
  salaoReservas    SalaoReservas[]
}

model SalaoTemaImagens {
  id        Int        @id @default(autoincrement())
  temaId    Int
  tema      SalaoTemas @relation(fields: [temaId], references: [id], onDelete: Cascade)
  imagem    String     @db.VarChar(255)
  descricao String?    @db.VarChar(255)
}

enum PostStatus {
  draft
  published
  archived
}

model Posts {
  id           Int            @id @default(autoincrement())
  title        String         @db.VarChar(200)
  slug         String         @unique @db.VarChar(200)
  status       PostStatus     @default(draft)
  publicoAlvo  String?        @db.VarChar(100)
  createdAt    DateTime       @default(now())
  publishedAt  DateTime?
  updatedAt    DateTime       @updatedAt
  postContents PostContents?
  postComments PostComments[]

  @@index([slug])
  @@index([publishedAt(sort: Desc)], map: "idx_posts_published_at")
}

model PostContents {
  id              Int      @id @default(autoincrement())
  postId          Int      @unique
  post            Posts    @relation(fields: [postId], references: [id], onDelete: Cascade)
  contentMarkdown String   @db.Text
  version         Int      @default(1)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model PostTags {
  id     Int    @id @default(autoincrement())
  postId Int
  tag    String @db.VarChar(50)

  @@unique([postId, tag])
}

model PostComments {
  id        Int      @id @default(autoincrement())
  postId    Int
  author    String   @db.VarChar(100)
  content   String   @db.Text
  createdAt DateTime @default(now())

  post Posts @relation(fields: [postId], references: [id], onDelete: Cascade)
}
